<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelling Bee</title>
</head>
<body>
    <h1>Spelling Bee</h1>

    <p>Word: <span id="word-number">{{ current_word_number }}</span>/<span id="total-words">{{ total_words }}</span></p>

    <p>Score: Correct: <span id="correct">{{ score.correct }}</span> | Incorrect: <span id="incorrect">{{ score.incorrect }}</span></p>

    <input type="text" id="user-input">
    <button onclick="submitWord()">Submit</button>
    <button onclick="startPractice()">Start Practice</button>
    <button onclick="nextWord()">Next Word</button>
    <button onclick="repeatWord()">Repeat</button>

    <a href="/results">Results</a>

    <div id="result"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    let audio = new Audio();

    function playAudio(word) {
        fetch('/get_audio')
            .then(response => response.json())
            .then(data => {
                audio.src = 'data:audio/mp3;base64,' + data.audio_data;
                audio.play();
            });
    }

    function startPractice() {
        fetch('/start_practice', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    playAudio(data.word);
                }
            });
    }

    function submitWord() {
        let userInput = document.getElementById('user-input').value;
        $.post('/submit', { user_input: userInput }, function(data) {
            document.getElementById('result').innerText = data.result;
            document.getElementById('correct').innerText = data.score.correct;
            document.getElementById('incorrect').innerText = data.score.incorrect;
            document.getElementById('word-number').innerText = data.next_word_number;
            document.getElementById('user-input').value = '';
            playAudio(data.word);
        });
    }

    function nextWord() {
        fetch('/next_word')
            .then(response => response.json())
            .then(data => {
                document.getElementById('word-number').textContent = data.word_number;
                playAudio(data.word);
            });
    }

    function repeatWord() {
        fetch('/repeat_word')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    playAudio(data.word);
                }
            });
    }
    </script>
</body>
</html>